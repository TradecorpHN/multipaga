import{f as M,h as I,i as k,r as c,j as e}from"./index-BWBdPVw1.js";import{L as D}from"./LogicUtils-BHlKMc3t.js";const T=({amount:a,currency:i="USD",onSuccess:o,onError:s,onCancel:x,customerInfo:m={},metadata:g={}})=>{const{hyper:h,isLoading:w,error:f,createPaymentSession:b,confirmPayment:P}=M(),{elements:j,createElements:v}=I(),{paymentState:n,updatePaymentState:l,resetPaymentState:S}=k(),[d,L]=c.useState(null),[p,N]=c.useState(!1),[R,A]=c.useState(null);c.useEffect(()=>{(async()=>{try{if(!h||!a||a<=0)return;const t={amount:Math.round(a*100),currency:i.toLowerCase(),customer:m,metadata:{...g,source:"multipaga"},automatic_payment_methods:{enabled:!0}},y=await b(t);A(y.client_secret);const z=(await v({clientSecret:y.client_secret,appearance:{theme:"stripe",variables:{colorPrimary:"#0570de",colorBackground:"#ffffff",colorText:"#30313d",colorDanger:"#df1b41",fontFamily:"system-ui, sans-serif",spacingUnit:"4px",borderRadius:"6px"}}})).create("payment",{layout:"tabs"});L(z),l({status:"ready",paymentIntent:y})}catch(t){console.error("Error inicializando pago:",t),l({status:"failed",error:t.message}),s==null||s(t)}})()},[h,a,i,m,g,b,v,l,s]),c.useEffect(()=>(d&&document.getElementById("payment-element")&&d.mount("#payment-element"),()=>{d&&d.unmount()}),[d]);const C=async r=>{if(r.preventDefault(),!h||!j||!R){s==null||s(new Error("Elementos de pago no están listos"));return}N(!0),l({status:"processing"});try{const t=await P(j,{return_url:"http://localhost:5173/payment-complete"});if(t.error)throw new Error(t.error.message);l({status:"succeeded",paymentIntent:t.paymentIntent}),o==null||o(t)}catch(t){console.error("Error procesando pago:",t),l({status:"failed",error:t.message}),s==null||s(t)}finally{N(!1)}},E=()=>{S(),x==null||x()},u=(r,t)=>D.formatCurrency(r,t);if(w||n.status==="idle")return e.jsxs("div",{className:"flex items-center justify-center p-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),e.jsx("span",{className:"ml-2 text-gray-600",children:"Inicializando pago..."})]});if(f||n.status==="failed"){const r=f||n.error;return e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("svg",{className:"h-5 w-5 text-red-400",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("h3",{className:"text-sm font-medium text-red-800",children:"Error en el pago"}),e.jsx("div",{className:"mt-2 text-sm text-red-700",children:r}),e.jsx("div",{className:"mt-4",children:e.jsx("button",{onClick:()=>window.location.reload(),className:"bg-red-100 px-3 py-2 rounded-md text-sm font-medium text-red-800 hover:bg-red-200",children:"Reintentar"})})]})]})})}return n.status==="succeeded"?e.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("svg",{className:"h-5 w-5 text-green-400",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("h3",{className:"text-sm font-medium text-green-800",children:"Pago exitoso"}),e.jsxs("div",{className:"mt-2 text-sm text-green-700",children:["Tu pago de ",u(a,i)," ha sido procesado correctamente."]})]})]})}):e.jsxs("div",{className:"max-w-md mx-auto bg-white rounded-lg shadow-lg p-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Completar Pago"}),e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:u(a,i)}),m.email&&e.jsxs("div",{className:"text-sm text-gray-600 mt-1",children:["Para: ",m.email]})]}),e.jsxs("form",{onSubmit:C,className:"space-y-4",children:[e.jsx("div",{id:"payment-element",className:"mb-4"}),e.jsx("div",{className:"text-xs text-gray-500 mb-4",children:e.jsx("p",{children:"Tu pago está protegido por encriptación SSL de 256 bits."})}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("button",{type:"button",onClick:E,disabled:p,className:"flex-1 px-4 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"Cancelar"}),e.jsx("button",{type:"submit",disabled:p||n.status!=="ready",className:"flex-1 px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed",children:p?e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Procesando..."]}):`Pagar ${u(a,i)}`})]})]}),e.jsxs("div",{className:"mt-6 pt-4 border-t border-gray-200",children:[e.jsx("div",{className:"text-xs text-gray-500 text-center",children:"Aceptamos tarjetas de crédito, débito y métodos de pago digitales"}),e.jsxs("div",{className:"flex justify-center mt-2 space-x-2",children:[e.jsx("img",{src:"/hyperswitch/Gateway/VISA.svg",alt:"Visa",className:"h-6 w-auto"}),e.jsx("img",{src:"/hyperswitch/Gateway/MASTERCARD.svg",alt:"Mastercard",className:"h-6 w-auto"}),e.jsx("img",{src:"/hyperswitch/Gateway/AMERICANEXPRESS.svg",alt:"American Express",className:"h-6 w-auto"}),e.jsx("img",{src:"/hyperswitch/Gateway/PAYPAL.svg",alt:"PayPal",className:"h-6 w-auto"})]})]})]})};export{T as default};
