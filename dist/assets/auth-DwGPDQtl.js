import{a as n}from"./js.cookie-Cz0CWeBA.js";const A={LOGGED_OUT:"logged_out",CHECKING_AUTH:"checking_auth",PRE_LOGIN:"pre_login",LOGGED_IN:"logged_in",SESSION_EXPIRED:"session_expired"},a={domain:void 0,secure:!1,sameSite:"lax",expires:7},s={AUTH_TOKEN:"auth_token",REFRESH_TOKEN:"refresh_token",USER_INFO:"user_info",MERCHANT_ID:"merchant_id",ORG_ID:"org_id",PROFILE_ID:"profile_id",TWO_FA_TOKEN:"two_fa_token"},u=()=>"https://sandbox.hyperswitch.io",c={SIGNIN:"/user/v2/signin",SIGNIN_MAGIC_LINK:"/user/signin",SIGNOUT:"/user/signout",REFRESH_TOKEN:"/user/refresh_token",TOTP_VERIFY:"/user/2fa/totp/verify",TOTP_RESET:"/user/2fa/totp/reset",RECOVERY_CODE_VERIFY:"/user/2fa/recovery_code/verify",USER_INFO:"/user",SWITCH_MERCHANT:"/user/v2/switch_merchant",MERCHANT_ACCOUNT:"/accounts",MERCHANT_LIST:"/accounts/list",PAYMENTS_LIST:"/payments/list",PAYMENT_INTENT:"/payments",PAYMENT_CONFIRM:"/payments/{payment_id}/confirm",PAYMENT_CAPTURE:"/payments/{payment_id}/capture",PAYMENT_CANCEL:"/payments/{payment_id}/cancel",REFUNDS_LIST:"/refunds/list",REFUND_CREATE:"/refunds",DISPUTES_LIST:"/disputes/list",DISPUTE_EVIDENCE:"/disputes/{dispute_id}/evidence",ANALYTICS_PAYMENTS:"/analytics/v1/merchant/metrics/payments",ANALYTICS_REFUNDS:"/analytics/v1/merchant/metrics/refunds",ANALYTICS_SDK:"/analytics/v1/sdk_events/metrics",CONNECTORS_LIST:"/account/{account_id}/connectors",CONNECTOR_CREATE:"/account/{account_id}/connectors",CONNECTOR_UPDATE:"/account/{account_id}/connectors/{connector_id}",WEBHOOKS_LIST:"/webhooks",WEBHOOK_CREATE:"/webhooks",API_KEYS_LIST:"/api_keys/list",API_KEY_CREATE:"/api_keys",BUSINESS_PROFILE:"/account/{account_id}/business_profile",ROUTING_CONFIG:"/routing",CUSTOMERS_LIST:"/customers/list",CUSTOMER_CREATE:"/customers"};class d{constructor(){this.baseURL=u(),this.interceptors=[]}setupAxiosInterceptors(e){e.interceptors.request.use(t=>{const r=this.getAuthToken();return r&&(t.headers.Authorization=`Bearer ${r}`),t.headers["Content-Type"]="application/json",t.headers.Accept="application/json",t},t=>Promise.reject(t)),e.interceptors.response.use(t=>t,async t=>{var o;const r=t.config;if(((o=t.response)==null?void 0:o.status)===401&&!r._retry){r._retry=!0;try{await this.refreshToken();const i=this.getAuthToken();return r.headers.Authorization=`Bearer ${i}`,e(r)}catch(i){return this.clearAuth(),window.location.href="/login",Promise.reject(i)}}return Promise.reject(t)})}setAuthToken(e){n.set(s.AUTH_TOKEN,e,a)}getAuthToken(){return n.get(s.AUTH_TOKEN)}setRefreshToken(e){n.set(s.REFRESH_TOKEN,e,a)}getRefreshToken(){return n.get(s.REFRESH_TOKEN)}setUserInfo(e){n.set(s.USER_INFO,JSON.stringify(e),a)}getUserInfo(){const e=n.get(s.USER_INFO);return e?JSON.parse(e):null}setMerchantId(e){n.set(s.MERCHANT_ID,e,a)}getMerchantId(){return n.get(s.MERCHANT_ID)}setOrgId(e){n.set(s.ORG_ID,e,a)}getOrgId(){return n.get(s.ORG_ID)}setProfileId(e){n.set(s.PROFILE_ID,e,a)}getProfileId(){return n.get(s.PROFILE_ID)}setTwoFAToken(e){n.set(s.TWO_FA_TOKEN,e,a)}getTwoFAToken(){return n.get(s.TWO_FA_TOKEN)}clearAuth(){Object.values(s).forEach(e=>{n.remove(e),a.domain&&n.remove(e,{domain:a.domain})})}isAuthenticated(){const e=this.getAuthToken(),t=this.getUserInfo();return!!(e&&t)}requires2FA(){return!!this.getTwoFAToken()}async signIn(e,t){try{const o=await fetch(`${this.baseURL}${c.SIGNIN}`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({email:e,password:t})}),i=await o.json();if(console.log("[DEBUG] Login response token:",i.token),!o.ok)throw new Error(i.message||"Error de autenticaci贸n");return i.two_factor_auth_required?(this.setTwoFAToken(i.token),{requires2FA:!0,token:i.token}):(this.setAuthToken(i.token),i.refresh_token&&this.setRefreshToken(i.refresh_token),await this.fetchUserInfo(),{success:!0})}catch(r){throw console.error("Error en signIn:",r),r}}async signInWithMagicLink(e){try{const t=await fetch(`${this.baseURL}${c.SIGNIN_MAGIC_LINK}`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({email:e})}),r=await t.json();if(!t.ok)throw new Error(r.message||"Error enviando magic link");return{success:!0,message:r.message}}catch(t){throw console.error("Error en signInWithMagicLink:",t),t}}async verify2FA(e,t=null){try{const r=this.getTwoFAToken();if(!r)throw new Error("Token 2FA no encontrado");const o=t?c.RECOVERY_CODE_VERIFY:c.TOTP_VERIFY,i=t?{recovery_code:t}:{totp:e},_=await fetch(`${this.baseURL}${o}`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json",Authorization:`Bearer ${r}`},body:JSON.stringify(i)}),E=await _.json();if(!_.ok)throw new Error(E.message||"Error verificando 2FA");return this.setAuthToken(E.token),E.refresh_token&&this.setRefreshToken(E.refresh_token),n.remove(s.TWO_FA_TOKEN),await this.fetchUserInfo(),{success:!0}}catch(r){throw console.error("Error en verify2FA:",r),r}}async fetchUserInfo(){try{const e=this.getAuthToken();if(console.log("[DEBUG] Token before /user:",e),!e)throw new Error("No hay token de autenticaci贸n");const t=void 0,r=await fetch(`${this.baseURL}${c.USER_INFO}`,{method:"GET",headers:{Authorization:`Bearer ${e}`,Accept:"application/json",...t?{"x-api-key":t}:{}}}),o=await r.json();if(!r.ok)throw new Error(o.message||"Error obteniendo informaci贸n del usuario");return this.setUserInfo(o),o.merchant_id&&this.setMerchantId(o.merchant_id),o.org_id&&this.setOrgId(o.org_id),o.profile_id&&this.setProfileId(o.profile_id),o}catch(e){throw console.error("Error en fetchUserInfo:",e),e}}async refreshToken(){try{const e=this.getRefreshToken();if(!e)throw new Error("No hay refresh token");const t=await fetch(`${this.baseURL}${c.REFRESH_TOKEN}`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({refresh_token:e})}),r=await t.json();if(!t.ok)throw new Error(r.message||"Error refrescando token");return this.setAuthToken(r.token),r.refresh_token&&this.setRefreshToken(r.refresh_token),r}catch(e){throw console.error("Error en refreshToken:",e),this.clearAuth(),e}}async signOut(){try{const e=this.getAuthToken();e&&await fetch(`${this.baseURL}${c.SIGNOUT}`,{method:"POST",headers:{Authorization:`Bearer ${e}`,Accept:"application/json"}})}catch(e){console.error("Error en signOut:",e)}finally{this.clearAuth()}}async switchMerchant(e){try{const t=this.getAuthToken();if(!t)throw new Error("No hay token de autenticaci贸n");const r=await fetch(`${this.baseURL}${c.SWITCH_MERCHANT}`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`,Accept:"application/json"},body:JSON.stringify({merchant_id:e})}),o=await r.json();if(!r.ok)throw new Error(o.message||"Error cambiando merchant");return this.setMerchantId(e),await this.fetchUserInfo(),o}catch(t){throw console.error("Error en switchMerchant:",t),t}}}const T=new d,f=()=>{const h=T.getAuthToken();return h?{Authorization:`Bearer ${h}`}:{}},p=()=>{const h=T.getMerchantId();return h?{"x-merchant-id":h}:{}},O=()=>({"Content-Type":"application/json",Accept:"application/json",...f(),...p()});export{c as API_ENDPOINTS,A as AUTH_STATES,T as authService,T as default,O as getApiHeaders,f as getAuthHeaders,p as getMerchantHeaders};
