import{r as c,u as A,e as b}from"./index-DeblWV9C.js";const E={CUSTOMERS:"CUSTOMERS",V2_CONNECTOR:"V2_CONNECTOR",V2_ORDERS_LIST:"V2_ORDERS_LIST",V2_ATTEMPTS_LIST:"V2_ATTEMPTS_LIST",PROCESS_TRACKER:"PROCESS_TRACKER",V2_ORDER_FILTERS:"V2_ORDER_FILTERS",V2_ORDERS_AGGREGATE:"V2_ORDERS_AGGREGATE",PAYMENT_METHOD_LIST:"PAYMENT_METHOD_LIST",TOTAL_TOKEN_COUNT:"TOTAL_TOKEN_COUNT",RETRIEVE_PAYMENT_METHOD:"RETRIEVE_PAYMENT_METHOD"},C={NONE:"NONE",MERCHANT:"MERCHANT",PROFILE:"PROFILE"},g={MERCHANT:"Merchant",PROFILE:"Profile"},I={SANDBOX:"https://sandbox.hyperswitch.io",PRODUCTION:"https://api.hyperswitch.io"},L=({entityName:e,userType:a=C.NONE,methodType:s,id:r=null,profileId:l,merchantId:u,transactionEntity:i,queryParameters:n=null})=>{const o="v2/connector-accounts",t="v2/payments";switch(e){case E.CUSTOMERS:switch(s){case"GET":return r?`v2/customers/${r}`:"v2/customers/list";default:return""}case E.V2_CONNECTOR:switch(s){case"GET":return r?`${o}/${r}`:`v2/profiles/${l}/connector-accounts`;case"PUT":case"POST":return r?`${o}/${r}`:o;default:return""}case E.V2_ORDERS_LIST:switch(s){case"GET":return r?n?`${t}/${r}?${n}`:`${t}/${r}/get-intent`:n?`${t}/list?${n}`:`${t}/list?limit=100`;default:return""}case E.V2_ATTEMPTS_LIST:switch(s){case"GET":return r?`${t}/${r}/list_attempts`:"";default:return""}case E.PROCESS_TRACKER:switch(s){case"GET":return r?`v2/process_tracker/revenue_recovery_workflow/${r}`:"v2/process_tracker/revenue_recovery_workflow";default:return""}case E.V2_ORDER_FILTERS:return"v2/payments/profile/filter";case E.V2_ORDERS_AGGREGATE:switch(s){case"GET":if(n)switch(i){case g.MERCHANT:return`v2/payments/aggregate?${n}`;case g.PROFILE:return`v2/payments/profile/aggregate?${n}`;default:return`v2/payments/aggregate?${n}`}return"";default:return""}case E.PAYMENT_METHOD_LIST:return r?`v2/customers/${r}/saved-payment-methods`:"";case E.TOTAL_TOKEN_COUNT:return"v2/customers/total-payment-methods";case E.RETRIEVE_PAYMENT_METHOD:return r?`v2/customers/payment-methods/${r}`:"";default:return""}},$=({uri:e,headers:a={},contentType:s="application/json",xFeatureRoute:r=!0,token:l,merchantId:u,profileId:i,version:n="V1"})=>{if(e.includes("mixpanel"))return{"Content-Type":"application/x-www-form-urlencoded",accept:"application/json"};const t={...a};return l&&(n==="V1"?(t.authorization=`Bearer ${l}`,t["api-key"]="hyperswitch"):n==="V2"&&(t.authorization=`Bearer ${l}`)),s&&(t["Content-Type"]=s),r&&(e.includes("lottie-files")||e.includes("config/merchant")||e.includes("config/feature")?t["Content-Type"]="application/json":t["x-feature"]="integ-custom"),e.includes("dynamic-routing")&&(t["x-feature"]="dynamo-simulator"),i&&(t["X-Profile-Id"]=i),u&&(t["X-Merchant-Id"]=u),t},U=(e,a)=>`${e}/${a}`,V=async e=>{if(!e.ok){const s=await e.json().catch(()=>({}));throw new Error(`HTTP ${e.status}: ${s.message||e.statusText}`)}const a=e.headers.get("content-type");return a&&a.includes("application/json")?await e.json():await e.text()},y=e=>{if(console.error("API Error:",e),e.message.includes("401")){localStorage.clear(),window.location.href="/login";return}throw e},_={V2_ENTITY_TYPES:E,USER_TYPES:C,TRANSACTION_ENTITY:g,BASE_URLS:I,getV2Url:L,getHeaders:$,buildFullUrl:U,handleResponse:V,handleApiError:y};var v={};const k=()=>{const[e,a]=c.useState(0),s=e>0,r=c.useCallback(()=>{a(u=>u+1)},[]),l=c.useCallback(()=>{a(u=>Math.max(0,u-1))},[]);return{isLoading:s,pendingRequests:e,incrementProgress:r,decrementProgress:l}},P=()=>{const{token:e,setAuthStateToLogout:a}=b(),{merchantInfo:s,profileInfo:r}=A(),{incrementProgress:l,decrementProgress:u}=k();return c.useCallback(async({uri:n,bodyStr:o="",bodyFormData:t=null,headers:T={},method:f="GET",contentType:S="application/json",xFeatureRoute:R=!0,forceCookies:w=!1,merchantId:N=(s==null?void 0:s.merchant_id)||"",profileId:M=(r==null?void 0:r.profile_id)||"",version:m="V1"})=>{try{l();const h=_.getHeaders({uri:n,headers:T,contentType:S,xFeatureRoute:R,token:e,merchantId:N,profileId:M,version:m});let p=null;f!=="GET"&&(t?(p=t,delete h["Content-Type"]):o&&(p=o));const O={method:f,headers:h,credentials:w?"same-origin":"omit"};p&&(O.body=p);const d=await fetch(n,O);return d.status===401&&(a(),window.location.href="/login"),d}catch(h){throw console.error("API Fetcher Error:",h),h}finally{u()}},[e,s,r,a,l,u])},D=()=>{const e=P(),[a,s]=c.useState(!1),[r,l]=c.useState(null),u=c.useRef(null),i=c.useCallback(async(o,t={})=>{try{s(!0),l(null),u.current&&u.current.abort(),u.current=new AbortController;const T=await e({uri:o,method:"GET",...t});return await _.handleResponse(T)}catch(T){throw T.name!=="AbortError"&&(l(T),_.handleApiError(T)),T}finally{s(!1)}},[e]),n=c.useCallback(()=>{u.current&&u.current.abort()},[]);return{getMethod:i,loading:a,error:r,cancelRequest:n}},F=()=>{const e=P(),[a,s]=c.useState(!1),[r,l]=c.useState(null);return{updateMethod:c.useCallback(async(i,n={})=>{try{s(!0),l(null);const o=await e({uri:i,method:"POST",...n});return await _.handleResponse(o)}catch(o){throw l(o),_.handleApiError(o),o}finally{s(!1)}},[e]),loading:a,error:r}},x=()=>{const{merchantInfo:e,profileInfo:a}=A();return{buildUrl:c.useCallback((r,l={})=>{const u=v.REACT_APP_API_BASE_URL||_.BASE_URLS.SANDBOX,i={entityName:r,merchantId:e==null?void 0:e.merchant_id,profileId:a==null?void 0:a.profile_id,...l},n=_.getV2Url(i);return _.buildFullUrl(u,n)},[e,a])}},H=(e=1,a=10)=>{const[s,r]=c.useState(e),[l,u]=c.useState(a),[i,n]=c.useState(0),o=Math.ceil(i/l),t=c.useCallback(R=>{R>=1&&R<=o&&r(R)},[o]),T=c.useCallback(()=>{t(s+1)},[s,t]),f=c.useCallback(()=>{t(s-1)},[s,t]),S=c.useCallback(R=>{u(R),r(1)},[]);return{currentPage:s,pageSize:l,totalItems:i,totalPages:o,setTotalItems:n,goToPage:t,goToNextPage:T,goToPreviousPage:f,changePageSize:S,hasNextPage:s<o,hasPreviousPage:s>1}},Y=(e={})=>{const[a,s]=c.useState(e),r=c.useCallback((n,o)=>{s(t=>({...t,[n]:o}))},[]),l=c.useCallback(n=>{s(o=>{const t={...o};return delete t[n],t})},[]),u=c.useCallback(()=>{s(e)},[e]),i=c.useCallback(()=>{const n=new URLSearchParams;return Object.entries(a).forEach(([o,t])=>{t!=null&&t!==""&&n.append(o,t)}),n.toString()},[a]);return{filters:a,updateFilter:r,removeFilter:l,clearFilters:u,buildQueryString:i}};export{E as V,x as a,H as b,Y as c,F as d,D as u};
